apiVersion: promptkit.altairalabs.ai/v1alpha1
kind: Scenario
metadata:
  name: context-limited-oldest
  annotations:
    test_goal: verify oldest messages are dropped when over budget
spec:
  id: context-limited-oldest
  task_type: chat
  description: Test truncation with 'oldest' strategy - drops old messages first
  context_policy:
    token_budget: 500
    reserve_for_output: 200
    strategy: oldest
  turns:
  - role: user
    content: Hi! I'm learning about space. My name is Alice and I'm in 5th grade.
  - role: user
    content: Can you tell me about the solar system? I need to know about all the
      planets.
  - role: user
    content: What are the inner planets and what makes them different from outer planets?
  - role: user
    content: Tell me more about Jupiter. I heard it's really big and has a red spot.
  - role: user
    content: What about Saturn's rings? How were they formed?
    assertions:
    - type: content_includes
      params:
        patterns:
        - Saturn
        - rings
  - role: user
    content: Which planet has the most moons?
    assertions:
    - type: content_includes
      params:
        patterns:
        - moons
        - Saturn
  - role: user
    content: What's my name again?
    assertions:
    - type: content_matches
      params:
        pattern: (?i)(haven't.*mentioned|haven't.*provided|don't.*have|can't.*answer|can't.*provide|don't.*know|not.*provided|no.*name)
        message: Should indicate inability to remember name due to context truncation
  context_metadata:
    domain: astronomy
    user_role: science tutor
